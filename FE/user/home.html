<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Viet Holiday</title>
        <link rel="stylesheet" href="index.css">
    </head>

    <header class="header"> 
        <div class="logo">
            <img class="header-logo" src="../image/logo.png" alt="Logo">
        </div>

        <nav class="navbar">
            <ul>
                <li><a href="home.html" class="active-nav">Home</a></li>
                <li><a href="about_us.html">About Us</a></li>
                <li><a href="#">Services</a></li>
                <li><a href="vehicle.html"> Vehicles</a></li>
            </ul>
        </nav>

        <div class="user-account-container">
            <button id="signin-btn" class="signin-btn"><a href="signin.html">Sign In</a></button>
        </div>
    </header>
    
    <body>
        <div class="container-general">
            <div class="container">
                <div class="welcome-container">
                    <span class="welcome">Welcome</span><br>
                    <span>Find your best vehicle</span>
                </div>
                <form action="">
                    <div class="pickup-container">
                        <span>Pickup Location:</span><br>
                        <select name="pick-up-location" id="pick-up-location">
                            <option value="" disabled selected>-Please select a pickup location-</option>
                            <option value="Ho Chi Minh">Ho Chi Minh City</option>
                            <option value="Vung Tau">Vung Tau</option>
                            <option value="Dong Nai">Dong Nai</option>
                            <option value="Long An">Long An</option>
                            <option value="Can Tho">Can Tho</option>
                        </select>
                    </div>
            
                    <div class="destination-container">
                        <span>Destination:</span><br>
                        <select name="destination" id="destination">
                            <option value="" disabled selected>-Please select a destination-</option>
                            <option value="Ho Chi Minh">Ho Chi Minh City</option>
                            <option value="Vung Tau">Vung Tau</option>
                            <option value="Dong Nai">Dong Nai</option>
                            <option value="Long An">Long An</option>
                            <option value="Can Tho">Can Tho</option>
                        </select>
                    </div>
            
                    <div class="time-container">
                        <div class="date">
                            <span>Pickup Date</span><br>
                            <input type="date" id="pick-up-date" class="pick-up-date">
                        </div>
                        <div class="time">
                            <span>Pickup Time</span> <br>
                            <input type="time"id="pick-up-time" class="pick-up-time">
                        </div> 
                    </div>
            
                    <div class="more-info-container">
                        <div class="seats">
                            <span>Vehicle</span><br>
                            <select name="seats-type" id="seats-type">
                                <option value="" disabled selected>-Seats Type-</option>
                                <option value="4">4</option>
                                <option value="7">7</option>
                                <option value="16">16</option>
                                <option value="29">29</option>
                                <option value="35">35</option>
                                <option value="45">45</option>
                            </select>
                        </div>
                        <div class="children">
                            <span>Children</span><br>
                            <input type="number" id="children-input" class="children-input" min="0">
                        </div>
                        <div class="adult">
                            <span>Adults</span><br>
                            <input type="number" id="adult-input" class="adult-input" min="0">
                        </div>
                    </div>
                </form>
                
                <span class="note">*Prices on the website are the reference only. For more details,</span><br>
                <span class="note">please contact us directly</span><br>
        
                <button type="submit" class="search-button" onclick="search()">Search</button>
            </div>
        
            <div class="slogan">    
                <span class="slogan-text">MAKE TRIPS BETTER</span> <br>
                <span class="slogan-text-2">Offering the best service</span>
            </div>
        </div>
        
        <div class="body-container">
            <h1> WHY CHOOSE US?</h1>
            <div class="card-container">
                <div class="card">
                    <box-icon name='support' size="100px"></box-icon>
                    <img class="cus-sup" src="../image/4983559.png" alt="Customer Support">
                    <h2>Customer Support</h2>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                </div>

                <div class="card">
                    <box-icon type='solid' name='planet' size="100px"></box-icon>
                    <img class="bus-travel" src="../image/3147375-200.png" alt="Business Travel">
                    <h2>Business Travel</h2>
                    <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. </p>
                </div>

                <div class="card">
                    <box-icon name='heart' type='solid' size="100px"></box-icon>
                    <img class="care" src="../image/335636-200.png" alt="Duty of Care">
                    <h2>Duty of Care</h2>
                    <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</p>
                </div>
            </div>
        </div>
        
        
        <script>
            const searchParams = new URLSearchParams(window.location.search);
            const userId = searchParams.get('user.id');
            const userAccountSelect = document.getElementById("user-account");

            if (userId) {
                const homeLink = document.querySelector('a[href="home.html"]');
                const homeParams = new URLSearchParams(window.location.search);
                homeParams.set('user.id', userId);
                homeLink.href = `home.html?${homeParams.toString()}`;

                const aboutUsLink = document.querySelector('a[href="about_us.html"]');
                const aboutUsParams = new URLSearchParams(window.location.search);
                aboutUsParams.set('user.id', userId);
                aboutUsLink.href = `about_us.html?${aboutUsParams.toString()}`;

                const vehicleLink = document.querySelector('a[href="vehicle.html"]');
                const vehicleParams = new URLSearchParams(window.location.search);
                vehicleParams.set('user.id', userId);
                vehicleLink.href = `vehicle.html?${vehicleParams.toString()}`;

                getUserName(userId)
                    .then(userName => {
                    const selectBox = document.createElement('select');
                    selectBox.id = 'user-account';
                    selectBox.innerHTML = `
                        <option value="">Welcome, ${userName}</option>
                        <option value="profile.html">My Profile</option>
                        <option value="signout.html">Sign Out</option>
                    `;
                    const signinBtn = document.getElementById('signin-btn');
                    signinBtn.parentNode.replaceChild(selectBox, signinBtn);

                    selectBox.addEventListener("change", function() {
                        const selectedOption = selectBox.value;
                        if (selectedOption === "profile.html") {
                        window.location.href = "/editProfile.html?user.id=" + userId;
                        } else if (selectedOption === "signout.html") {
                        window.location.href = 'signin.html';
                        }
                    });
                    })
                    .catch(error => {
                    console.error('Error:', error);
                    });
            }

            function getUserName(id) {
                return fetch(`http://localhost:8080/users`)
                    .then(response => response.json())
                    .then(users => {
                    const foundUser = users.find(user => user.id === parseInt(id));
                    if (foundUser) {
                        return foundUser.userName;
                    } else {
                        throw new Error(`User with id ${id} not found`);
                    }
                    })
                    .catch(error => {
                    console.error('Error:', error);
                    });
            }

            window.onscroll = function() {scrollFunction()};

            function scrollFunction() {
                if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                    document.getElementById("container").style.top = "0";
                } else {
                    document.getElementById("container").style.top = "-50px";
                }
            }

            function search() {
                const pickupLocation = document.getElementById("pick-up-location");
                const destination = document.getElementById("destination");
                const pickupDate = document.getElementById("pick-up-date");
                const pickupTime = document.getElementById("pick-up-time");
                const seatsType = document.getElementById("seats-type");
                const childrenInput = document.getElementById("children-input");
                const adultInput = document.getElementById("adult-input");

                const totalPassengers = parseInt(childrenInput.value) + parseInt(adultInput.value) + 1;
                console.log(totalPassengers);

                if(seatsType.value < totalPassengers) {
                    alert("The total passengers are more than the seat type of the vehicle. Please select the vehicle with a larger seat type number.");
                    return;
                }
                
                if(userId === null){
                    const url = `searchPage.html?pickupLocation=${pickupLocation.value}&destination=${destination.value}&pickupDate=${pickupDate.value}&pickupTime=${pickupTime.value}&seatsType=${seatsType.value}&childrenInput=${childrenInput.value}&adultInput=${adultInput.value}`;
                    window.location.href = url;
                    return;
                }
                const url = `searchPage.html?user.id=${userId}&pickupLocation=${pickupLocation.value}&destination=${destination.value}&pickupDate=${pickupDate.value}&pickupTime=${pickupTime.value}&seatsType=${seatsType.value}&childrenInput=${childrenInput.value}&adultInput=${adultInput.value}`;
                window.location.href = url;
            }
        </script>
    </body>
    <footer class="footer">
        <div class="footer-top">
            <div class="subscribe-container">    
                <h2>Subscribe our newsletter</h2>
                <span>Want to know about our offer first?</span> <br>
                <input type="text" class="email" id="email" placeholder="example@gmail.com">
                <button>Subscribe</button>
            </div>

            <div class="logo-container">
                <img src="../image/logo.png" alt="Logo">
            </div>
        </div>
        
        <div class="footer-bottom">
            <div class="footer-contact-info">
                <box-icon name='phone' type='solid' size="36px" color="#FFCD6B"></box-icon> <br>
                <span>+84 (0) 933 9696 17</span> <br>
                <span>Mr. Nam</span>
            </div>
            <div class="footer-contact-info">
                <box-icon name='location-plus' type='solid' size="36px" color="#FFCD6B"></box-icon> <br>
                <span>aaaaaaaaaaaaaaaaaaa</span>
            </div>
            <div class="footer-contact-info">
                <box-icon name='envelope' type='solid' size="36px" color="#FFCD6B"></box-icon> <br>
                <span>example@gmail.com</span>
            </div>
            <div class="working-hours footer-contact-info">
                <box-icon name='pie-chart-alt' size="36px" color="#FFCD6B"></box-icon> <br>
                <span>Mon-Fri: 8:00-21:00</span> <br>
                <span>Sat-Sun: 9:30-19:30</span>
            </div>
        </div>
        
        <div class="group-id">
            <span>Group 18</span>
        </div>

    </footer>
</html>